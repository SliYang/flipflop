<!DOCTYPE html>
<html class="theme theme-white">
<head>
<meta charset="utf-8">
<title>常用数据库</title>
<link href="https://www.zybuluo.com/static/assets/template-theme-white.css" rel="stylesheet" media="screen">
<style type="text/css">

#wmd-preview h1  {
    color: #0077bb; /* 将标题改为蓝色 */
}</style>
</head>
<body class="theme theme-white">
<div id="wmd-preview" class="wmd-preview wmd-preview-full-reader"><div class="md-section-divider"></div><div class="md-section-divider"></div><h1 data-anchor-id="i19c" id="常用数据库">常用数据库</h1><p data-anchor-id="ob02"><code>DB</code> <code>kegg</code> <code>eggNOG4.5</code></p><hr><p data-anchor-id="yv95"><a href="http://www.kegg.jp/" target="_blank">KEGG</a> <br>
常用旗下主要检索： <br>
HYPERLINK format: <code>http://www.kegg.jp/kegg/&lt;数据库字段&gt;.html</code> <br>
dbget 通用检索HYPERLINK format：<code>http://www.kegg.jp/dbget-bin/www_bget?&lt;数据库字段&gt;:&lt;检索项&gt;</code> 若检索项种有:则不需要指定&lt;数据库字段&gt; #未核实 <br>
 - <a href="http://www.kegg.jp/kegg/pathway.html" target="_blank">KEGG PATHWAY</a> <code>KEGG pathway maps</code> 字段<code>pathway</code> <br>
 - <a href="http://www.kegg.jp/kegg/ko.html" target="_blank">ORTHOLOGY</a> <code>KO fuctional orthologys</code> 字段<code>ko</code> 注释主要使用库 <br>
 - <a href="http://www.kegg.jp/kegg/module.html" target="_blank">KEGG MODULE</a> <code>KEGG moduels</code> 字段<code>module</code></p><blockquote data-anchor-id="5qxq" class="white-blockquote">
  <p>用户seqid 对应到knumber步骤</p>
</blockquote><p data-anchor-id="1dlx"><strong>1. 数据准备</strong> <br>
<a href="http://kobas.cbi.pku.edu.cn/" target="_blank">kobas</a> 北大，数据自提  <br>
<code>$KOBAS/seq_pep/ko.pep.fasta</code> 作为比对所需db文件 <br>
id example of ko.pep.fasta  <br>
<code>&gt;aaa:Acav_0001</code> <br>
<code>&gt;aaa:Acav_0002</code> <br>
<code>&gt;aaa:Acav_0003</code> <br>
说明：id格式为 <code>物种缩写:genename</code> 此<code>genename</code>暂时理解是<code>gene symble</code> <br>
物种缩写与物种命名对应链接 <br>
<code>$KOBAS/sqlite/ko.db</code> 用sqlite3 ko.db 查找及导出内容 <br>
如导出KoGenes table内容，结果为K-number|pep-id</p><blockquote data-anchor-id="wfhu" class="white-blockquote">
  <p><img src="http://static.zybuluo.com/sliyang/qtqm9m35dqvh08dcxnx0jqbl/image_1b92dj3h81vgu1cuqs039651ibm1u.png" alt="image_1b92dj3h81vgu1cuqs039651ibm1u.png-16kB" title=""></p>
</blockquote><p data-anchor-id="kpkg"><strong>2. <a href="http://www.bioconductor.org/packages/release/bioc/html/KEGGREST.html" target="_blank">KEGGREST</a>对k-number提取注释</strong> <br>
r代码样例:</p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="lic3"><ol class="linenums"><li class="L0"><code class="language-{r,warning=TRUE}"><span class="pln">library</span><span class="pun">(</span><span class="pln">KEGGREST</span><span class="pun">)</span><span class="pln"> </span></code></li><li class="L1"><code class="language-{r,warning=TRUE}"><span class="pln">knum</span><span class="pun">&lt;-</span><span class="pln">c</span><span class="pun">(</span><span class="str">"K00001"</span><span class="pun">,</span><span class="str">"K00002"</span><span class="pun">,</span><span class="str">"K00003"</span><span class="pun">,</span><span class="str">"K00004"</span><span class="pun">,</span><span class="str">"K00005"</span><span class="pun">)</span></code></li><li class="L2"><code class="language-{r,warning=TRUE}"><span class="kwd">for</span><span class="pun">(</span><span class="pln">i </span><span class="kwd">in</span><span class="pln"> knum</span><span class="pun">)</span><span class="pln"> write</span><span class="pun">.</span><span class="pln">table</span><span class="pun">(</span><span class="pln">keggFind</span><span class="pun">(</span><span class="str">"ORTHOLOGY"</span><span class="pun">,</span><span class="pln">i</span><span class="pun">),</span><span class="pln">file</span><span class="pun">=</span><span class="str">"outputfile"</span><span class="pun">,</span><span class="pln">quote</span><span class="pun">=</span><span class="pln">F</span><span class="pun">,</span><span class="pln">append</span><span class="pun">=</span><span class="pln">T</span><span class="pun">,</span><span class="pln">col</span><span class="pun">.</span><span class="pln">names</span><span class="pun">=</span><span class="pln">F</span><span class="pun">)</span><span class="pln"> </span></code></li><li class="L3"><code class="language-{r,warning=TRUE}"><span class="com">#append=T设置向output添加记录，不是重写outputfile，为了确保结果正确，运行前需确认outputfile是否存在。</span></code></li></ol></pre><p data-anchor-id="vulp">outputfile looks like： <br>
<img src="http://static.zybuluo.com/sliyang/0b3298qwy6tr6k4h15ld6gut/image_1b92dp7nu39q1i2m174m1ifu1c562b.png" alt="image_1b92dp7nu39q1i2m174m1ifu1c562b.png-19.2kB" title=""> <br>
<strong>3. 操作步骤</strong> <br>
 比对软件:<a href="https://blast.ncbi.nlm.nih.gov/Blast.cgi" target="_blank">BLAST+</a>或<a href="http://omics.informatics.indiana.edu/mg/RAPSearch/" target="_blank">RAPSearch</a>都可以，目的在于得到用户序列id与pep-id的对应关系，所以软件结果普通tab格式就可以。BLAST+速度慢，RAPSearch中间文件大小较大，但速度较快,输出格式blast版m8及aln，请自行取舍。</p><p data-anchor-id="j7za"><strong>2017.02.15数据统计:</strong> <br>
<code>tKoGenes</code> 189M <br>
<code>k-number</code> 19330(19个在ORTHOLOGY中显示no such data, 但对应gene可以检索到相关信息，所以有注释的为19311）</p><blockquote data-anchor-id="y7bj" class="white-blockquote">
  <p>举例K18501 <br>
     <img src="http://static.zybuluo.com/sliyang/wp2szwvn4a12c1wvb6hwhkdk/image_1b92dtqs3tg71og3lhgpmd161q2o.png" alt="image_1b92dtqs3tg71og3lhgpmd161q2o.png-27.1kB" title=""> <br>
     <img src="http://static.zybuluo.com/sliyang/0vbf6dlkmh24m3fdp9wlyukm/image_1b92dv8pasphoo31gr81i2qbms35.png" alt="image_1b92dv8pasphoo31gr81i2qbms35.png-5.2kB" title=""> <br>
     <img src="http://static.zybuluo.com/sliyang/27qlzrdcqignxovrp1jwhka1/image_1b92e1inmvqc1e7qg6v35mj0c3i.png" alt="image_1b92e1inmvqc1e7qg6v35mj0c3i.png-53.7kB"></p>
</blockquote><div class="md-section-divider"></div><h4 data-anchor-id="363l" id="missing-k-number-list"><code>missing k-number list:</code></h4><p data-anchor-id="vty7"><img src="http://static.zybuluo.com/sliyang/7xf0p5xwble60516rizf46i5/image_1b92dbe3q121hhnnbcq1hth11o714.png" alt="image_1b92dbe3q121hhnnbcq1hth11o714.png-11.3kB"></p><hr><p data-anchor-id="ok3i"><strong>sqlite3 使用说明·极简</strong></p><blockquote data-anchor-id="e7po" class="white-blockquote">
  <p>参数以<code>.</code>号开头 <br>
  <code>.help</code> 显示help信息 <br>
  <code>.schema</code> 查看数据库结构 <br>
  <code>.output</code> 输出到文件，默认结果<code>|</code>符号分割 <br>
  <code>SQL</code>增删查改</p>
</blockquote><hr><p data-anchor-id="dspq"><a href="http://eggnogdb.embl.de/#/app/home" target="_blank">eggNOG version4.5</a>  <br>
将序列进行注释，之后进行分类，最终得到分类结果 <br>
必须下载文件:  <br>
eggnog4.proteins.all.fa <br>
NOG.members.tsv <br>
NOG.annotations.tsv <br>
处理脚本:eggNOG45_result_process.pl <br>
<strong><em>pipeline:</em></strong></p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="4vvm"><ol class="linenums"><li class="L0"><code><span class="pln">pipe1 </span><span class="pun">&amp;&amp;</span><span class="pln"> pipe2</span></code></li></ol></pre><p data-anchor-id="kpof"><code>pipe1:</code></p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="u73v"><ol class="linenums"><li class="L0"><code><span class="pln">$RAPSearch</span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">prerapsearch </span><span class="pun">-</span><span class="pln">d eggnog4</span><span class="pun">.</span><span class="pln">proteins</span><span class="pun">.</span><span class="pln">all</span><span class="pun">.</span><span class="pln">fa </span><span class="pun">-</span><span class="pln">n eggnog4</span><span class="pun">.</span><span class="pln">protdb </span></code></li><li class="L1"><code><span class="pln">$RAPSearch</span><span class="pun">/</span><span class="pln">bin</span><span class="pun">/</span><span class="pln">rapsearch </span><span class="pun">-</span><span class="pln">q user</span><span class="pun">.</span><span class="pln">seq</span><span class="pun">.</span><span class="pln">fa </span><span class="pun">-</span><span class="pln">d </span><span class="pun">/</span><span class="pln">ABS_PATH</span><span class="pun">/</span><span class="pln">TO</span><span class="pun">/</span><span class="pln">eggnog4</span><span class="pun">.</span><span class="pln">protdb </span><span class="pun">-</span><span class="pln">o user</span><span class="pun">.</span><span class="pln">eg45</span><span class="pun">.</span><span class="pln">v1b1  </span><span class="pun">-</span><span class="pln">v </span><span class="lit">1</span><span class="pln"> </span><span class="pun">-</span><span class="pln">b </span><span class="lit">1</span></code></li><li class="L2"><code><span class="com">#1 &amp;&amp; 2 </span></code></li><li class="L3"><code><span class="com">#prerapsearch对eggnog蛋白序列进行建库</span></code></li><li class="L4"><code><span class="com">#rapsearch将用户输入数据与eggnog蛋白序列进行比对，-v 1 -b 1只输出一个比对结果，运行完成后 user.eg45.v1b1.m8是pipe2所需 -in 参数</span></code></li></ol></pre><p data-anchor-id="fktv"><code>pipe2:</code></p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="91me"><ol class="linenums"><li class="L0"><code><span class="pln">perl eggNOG45_result_process</span><span class="pun">.</span><span class="pln">pl </span><span class="pun">-</span><span class="kwd">in</span><span class="pln"> user</span><span class="pun">.</span><span class="pln">eg45</span><span class="pun">.</span><span class="pln">v1b1</span><span class="pun">.</span><span class="pln">m8 </span><span class="pun">-</span><span class="pln">annin NOG</span><span class="pun">.</span><span class="pln">annotations</span><span class="pun">.</span><span class="pln">tsv </span><span class="pun">-</span><span class="pln">member NOG</span><span class="pun">.</span><span class="pln">members</span><span class="pun">.</span><span class="pln">tsv </span><span class="pun">-</span><span class="pln">annout user</span><span class="pun">.</span><span class="pln">eg45</span><span class="pun">.</span><span class="pln">ann </span><span class="pun">-</span><span class="pln">stat user</span><span class="pun">.</span><span class="pln">eg45</span><span class="pun">.</span><span class="pln">stat</span></code></li><li class="L1"><code><span class="com">#user.eg45.ann是注释文件，user.eg45.stat是分类统计结果,user.eg45.stat.png是分类统计图。NOG.member.fmt, level_plot.R为中间文件，可删除</span></code></li></ol></pre><p data-anchor-id="q6n1"><code>user.eg45.ann looks like:</code> <br>
<img src="http://static.zybuluo.com/sliyang/60obbabr08mkn4xvgy9wdmym/image_1b951grq1olk1b2vr371rdd1kklm.png" alt="image_1b951grq1olk1b2vr371rdd1kklm.png-31.9kB"> <br>
<code>user.eg45.stat looks list:</code> <br>
<img src="http://static.zybuluo.com/sliyang/3f34xuo6bm5yjmfbc54b4a8d/image_1b951c2vc8mq1mrf1stl1e4hve79.png" alt="image_1b951c2vc8mq1mrf1stl1e4hve79.png-70.6kB"> <br>
<code>user.eg45.stat.png looks like:</code> <br>
<img src="http://static.zybuluo.com/sliyang/3dnv2gwn8d1zh54cgg7n1fm9/test_eg_stats.png" alt="test_eg_stats.png-762.2kB" title=""> <br>
<code>脚本代码:</code></p><div class="md-section-divider"></div><pre class="prettyprint linenums prettyprinted" data-anchor-id="c34p"><ol class="linenums"><li class="L0"><code class="language-perl"><span class="kwd">use</span><span class="pln"> autodie</span><span class="pun">;</span></code></li><li class="L1"><code class="language-perl"><span class="kwd">use</span><span class="pln"> strict</span><span class="pun">;</span></code></li><li class="L2"><code class="language-perl"><span class="kwd">use</span><span class="pln"> </span><span class="typ">Getopt</span><span class="pun">::</span><span class="typ">Long</span><span class="pun">;</span></code></li><li class="L3"><code class="language-perl"></code></li><li class="L4"><code class="language-perl"><span class="kwd">our</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$des</span><span class="pun">,</span><span class="pln">$member</span><span class="pun">,</span><span class="pln">$blast_tab</span><span class="pun">,</span><span class="pln">$blast_desc</span><span class="pun">,</span><span class="pln">$statistics</span><span class="pun">,</span><span class="pln">$help_flag</span><span class="pun">);</span></code></li><li class="L5"><code class="language-perl"><span class="pun">&amp;</span><span class="typ">GetOptions</span><span class="pun">(</span></code></li><li class="L6"><code class="language-perl"><span class="pln">   </span><span class="str">"annin=s"</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> \$des</span><span class="pun">,</span></code></li><li class="L7"><code class="language-perl"><span class="pln">   </span><span class="str">"member=s"</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> \$member</span><span class="pun">,</span></code></li><li class="L8"><code class="language-perl"><span class="pln">   </span><span class="str">"in=s"</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> \$blast_tab</span><span class="pun">,</span></code></li><li class="L9"><code class="language-perl"><span class="pln">   </span><span class="str">"annout=s"</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> \$blast_desc</span><span class="pun">,</span></code></li><li class="L0"><code class="language-perl"><span class="pln">   </span><span class="str">"statout=s"</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> \$statistics</span><span class="pun">,</span></code></li><li class="L1"><code class="language-perl"><span class="pln">   </span><span class="str">'h'</span><span class="pln"> </span><span class="pun">=&gt;</span><span class="pln"> \$help_flag</span><span class="pun">,</span></code></li><li class="L2"><code class="language-perl"><span class="pun">);</span></code></li><li class="L3"><code class="language-perl"><span class="kwd">if</span><span class="pun">(</span><span class="pln">$help_flag</span><span class="pun">){</span></code></li><li class="L4"><code class="language-perl"><span class="pln">   </span><span class="kwd">print</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">DATA</span><span class="pun">&gt;;</span></code></li><li class="L5"><code class="language-perl"><span class="pln">   </span><span class="kwd">exit</span><span class="pun">;</span></code></li><li class="L6"><code class="language-perl"><span class="pun">}</span></code></li><li class="L7"><code class="language-perl"><span class="kwd">if</span><span class="pun">(!</span><span class="pln">$des </span><span class="pun">|</span><span class="pln"> </span><span class="pun">!</span><span class="pln">$member </span><span class="pun">|</span><span class="pln"> </span><span class="pun">!</span><span class="pln">$blast_tab </span><span class="pun">|</span><span class="pln"> </span><span class="pun">!</span><span class="pln">$blast_desc </span><span class="pun">|</span><span class="pln"> </span><span class="pun">!</span><span class="pln">$statistics</span><span class="pun">){</span></code></li><li class="L8"><code class="language-perl"><span class="pln">   </span><span class="kwd">print</span><span class="pln"> </span><span class="pun">&lt;</span><span class="pln">DATA</span><span class="pun">&gt;;</span></code></li><li class="L9"><code class="language-perl"><span class="pln">   </span><span class="kwd">print</span><span class="pln"> </span><span class="str">"please check your input argument(s)\n"</span><span class="pun">;</span></code></li><li class="L0"><code class="language-perl"><span class="pln">   </span><span class="kwd">exit</span><span class="pun">;</span></code></li><li class="L1"><code class="language-perl"><span class="pun">}</span></code></li><li class="L2"><code class="language-perl"></code></li><li class="L3"><code class="language-perl"><span class="kwd">our</span><span class="pln"> </span><span class="pun">%</span><span class="pln">MEM</span><span class="pun">;</span></code></li><li class="L4"><code class="language-perl"><span class="kwd">our</span><span class="pln"> </span><span class="pun">%</span><span class="pln">GROUP</span><span class="pun">;</span></code></li><li class="L5"><code class="language-perl"><span class="kwd">our</span><span class="pln"> </span><span class="pun">%</span><span class="pln">DESC</span><span class="pun">;</span></code></li><li class="L6"><code class="language-perl"><span class="kwd">our</span><span class="pln"> </span><span class="pun">%</span><span class="pln">CODE</span><span class="pun">;</span></code></li><li class="L7"><code class="language-perl"><span class="kwd">our</span><span class="pln"> </span><span class="pun">%</span><span class="pln">CVT</span><span class="pun">;</span></code></li><li class="L8"><code class="language-perl"><span class="kwd">our</span><span class="pln"> </span><span class="lit">@stat</span><span class="pun">;</span></code></li><li class="L9"><code class="language-perl"><span class="kwd">our</span><span class="pln"> </span><span class="pun">%</span><span class="pln">NUM</span><span class="pun">;</span></code></li><li class="L0"><code class="language-perl"></code></li><li class="L1"><code class="language-perl"><span class="pln">main</span><span class="pun">();</span></code></li><li class="L2"><code class="language-perl"><span class="kwd">sub</span><span class="pln"> main</span><span class="pun">{</span></code></li><li class="L3"><code class="language-perl"><span class="pln">   parsing_annotations</span><span class="pun">();</span></code></li><li class="L4"><code class="language-perl"><span class="pln">   parsing_fmt_member</span><span class="pun">();</span></code></li><li class="L5"><code class="language-perl"><span class="pln">   parsing_member</span><span class="pun">();</span></code></li><li class="L6"><code class="language-perl"><span class="pln">   code</span><span class="pun">();</span></code></li><li class="L7"><code class="language-perl"><span class="pln">   STA</span><span class="pun">();</span></code></li><li class="L8"><code class="language-perl"><span class="pln">   </span><span class="kwd">my</span><span class="pln"> $png</span><span class="pun">=</span><span class="pln">$statistics</span><span class="pun">.</span><span class="str">".png"</span><span class="pun">;</span></code></li><li class="L9"><code class="language-perl"><span class="pln">   plot</span><span class="pun">(</span><span class="pln">$statistics</span><span class="pun">,</span><span class="pln">$png</span><span class="pun">);</span></code></li><li class="L0"><code class="language-perl"><span class="pun">}</span></code></li><li class="L1"><code class="language-perl"></code></li><li class="L2"><code class="language-perl"><span class="kwd">sub</span><span class="pln"> STA</span><span class="pun">{</span></code></li><li class="L3"><code class="language-perl"><span class="pln">   </span><span class="kwd">my</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$geneid</span><span class="pun">,</span><span class="pln">$blastid</span><span class="pun">,</span><span class="pln">$cvt</span><span class="pun">,</span><span class="pln">$groupstat</span><span class="pun">);</span></code></li><li class="L4"><code class="language-perl"><span class="pln">   open TAB</span><span class="pun">,</span><span class="str">"$blast_tab"</span><span class="pun">;</span></code></li><li class="L5"><code class="language-perl"><span class="pln">   open BDES</span><span class="pun">,</span><span class="str">"&gt;$blast_desc"</span><span class="pun">;</span></code></li><li class="L6"><code class="language-perl"><span class="pln">   open STAT</span><span class="pun">,</span><span class="str">"&gt;$statistics"</span><span class="pun">;</span></code></li><li class="L7"><code class="language-perl"><span class="pln">   </span><span class="kwd">while</span><span class="pun">(&lt;</span><span class="pln">TAB</span><span class="pun">&gt;){</span></code></li><li class="L8"><code class="language-perl"><span class="pln">      chomp</span><span class="pun">;</span></code></li><li class="L9"><code class="language-perl"><span class="pln">      </span><span class="kwd">if</span><span class="pun">(</span><span class="str">/^#/</span><span class="pun">){</span><span class="kwd">next</span><span class="pun">;}</span></code></li><li class="L0"><code class="language-perl"><span class="pln">      </span><span class="pun">(</span><span class="pln">$geneid</span><span class="pun">,</span><span class="pln">$blastid</span><span class="pun">)=(</span><span class="pln">split</span><span class="pun">(</span><span class="str">/\t/</span><span class="pun">,</span><span class="pln">$_</span><span class="pun">))[</span><span class="lit">0</span><span class="pun">,</span><span class="lit">1</span><span class="pun">];</span></code></li><li class="L1"><code class="language-perl"><span class="pln">      $CVT</span><span class="pun">{</span><span class="pln">$geneid</span><span class="pun">}=</span><span class="pln">$blastid</span><span class="pun">;</span></code></li><li class="L2"><code class="language-perl"><span class="pln">   </span><span class="pun">}</span></code></li><li class="L3"><code class="language-perl"><span class="pln">   close TAB</span><span class="pun">;</span></code></li><li class="L4"><code class="language-perl"><span class="pln">   </span><span class="kwd">foreach</span><span class="pln"> $cvt </span><span class="pun">(</span><span class="pln">sort keys </span><span class="pun">%</span><span class="pln">CVT</span><span class="pun">){</span></code></li><li class="L5"><code class="language-perl"><span class="pln">      </span><span class="kwd">print</span><span class="pln"> BDES </span><span class="str">"$cvt\t$CVT{$cvt}\t$MEM{$CVT{$cvt}}\t$GROUP{$MEM{$CVT{$cvt}}}\t$DESC{$MEM{$CVT{$cvt}}}\n"</span><span class="pun">;</span></code></li><li class="L6"><code class="language-perl"><span class="pln">      push </span><span class="lit">@stat</span><span class="pun">,</span><span class="pln">$GROUP</span><span class="pun">{</span><span class="pln">$MEM</span><span class="pun">{</span><span class="pln">$CVT</span><span class="pun">{</span><span class="pln">$cvt</span><span class="pun">}}};</span></code></li><li class="L7"><code class="language-perl"><span class="pln">   </span><span class="pun">}</span></code></li><li class="L8"><code class="language-perl"><span class="pln">   $groupstat</span><span class="pun">=</span><span class="pln">join</span><span class="pun">(</span><span class="str">""</span><span class="pun">,</span><span class="lit">@stat</span><span class="pun">);</span></code></li><li class="L9"><code class="language-perl"><span class="pln">   </span><span class="kwd">foreach</span><span class="pln"> </span><span class="kwd">my</span><span class="pln"> $code </span><span class="pun">(</span><span class="pln">keys </span><span class="pun">%</span><span class="pln">CODE</span><span class="pun">){</span></code></li><li class="L0"><code class="language-perl"><span class="pln">      $NUM</span><span class="pun">{</span><span class="pln">$code</span><span class="pun">}=</span><span class="pln">$groupstat</span><span class="pun">=~</span><span class="pln">s</span><span class="pun">/</span><span class="pln">$code</span><span class="pun">/</span><span class="com">#/g;</span></code></li><li class="L1"><code class="language-perl"><span class="pln">   </span><span class="pun">}</span></code></li><li class="L2"><code class="language-perl"><span class="pln">   </span><span class="kwd">foreach</span><span class="pln"> </span><span class="kwd">my</span><span class="pln"> $numkey </span><span class="pun">(</span><span class="pln">keys </span><span class="pun">%</span><span class="pln">NUM</span><span class="pun">){</span></code></li><li class="L3"><code class="language-perl"><span class="pln">      </span><span class="kwd">print</span><span class="pln"> STAT </span><span class="str">"$numkey\t$CODE{$numkey}\t$NUM{$numkey}\n"</span><span class="pun">;</span></code></li><li class="L4"><code class="language-perl"><span class="pln">   </span><span class="pun">}</span></code></li><li class="L5"><code class="language-perl"><span class="pun">}</span></code></li><li class="L6"><code class="language-perl"></code></li><li class="L7"><code class="language-perl"><span class="kwd">sub</span><span class="pln"> parsing_annotations</span><span class="pun">{</span></code></li><li class="L8"><code class="language-perl"><span class="pln">   </span><span class="kwd">my</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$group</span><span class="pun">,</span><span class="pln">$desc</span><span class="pun">,</span><span class="pln">$cog</span><span class="pun">);</span></code></li><li class="L9"><code class="language-perl"><span class="pln">   open DESC</span><span class="pun">,</span><span class="str">"$des"</span><span class="pun">;</span></code></li><li class="L0"><code class="language-perl"><span class="pln">   </span><span class="kwd">while</span><span class="pun">(&lt;</span><span class="pln">DESC</span><span class="pun">&gt;){</span></code></li><li class="L1"><code class="language-perl"><span class="pln">      chomp</span><span class="pun">;</span></code></li><li class="L2"><code class="language-perl"><span class="pln">      </span><span class="kwd">if</span><span class="pun">(</span><span class="str">/^#/</span><span class="pun">){</span><span class="kwd">next</span><span class="pun">;}</span></code></li><li class="L3"><code class="language-perl"><span class="pln">      </span><span class="kwd">my</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$cog</span><span class="pun">,</span><span class="pln">$group</span><span class="pun">,</span><span class="pln">$desc</span><span class="pun">)=(</span><span class="pln">split</span><span class="pun">(</span><span class="str">/\t/</span><span class="pun">,</span><span class="pln">$_</span><span class="pun">))[</span><span class="lit">1</span><span class="pun">,</span><span class="lit">4</span><span class="pun">,</span><span class="lit">5</span><span class="pun">];</span></code></li><li class="L4"><code class="language-perl"><span class="pln">      $GROUP</span><span class="pun">{</span><span class="pln">$cog</span><span class="pun">}=</span><span class="pln">$group</span><span class="pun">;</span></code></li><li class="L5"><code class="language-perl"><span class="pln">      $DESC</span><span class="pun">{</span><span class="pln">$cog</span><span class="pun">}=</span><span class="pln">$desc</span><span class="pun">;</span></code></li><li class="L6"><code class="language-perl"><span class="pln">   </span><span class="pun">}</span></code></li><li class="L7"><code class="language-perl"><span class="pln">   close DESC</span><span class="pun">;</span></code></li><li class="L8"><code class="language-perl"><span class="pun">}</span></code></li><li class="L9"><code class="language-perl"></code></li><li class="L0"><code class="language-perl"><span class="kwd">sub</span><span class="pln"> parsing_fmt_member</span><span class="pun">{</span></code></li><li class="L1"><code class="language-perl"><span class="pln">   </span><span class="kwd">my</span><span class="pun">(</span><span class="lit">@array</span><span class="pun">,</span><span class="lit">@mlist</span><span class="pun">);</span></code></li><li class="L2"><code class="language-perl"><span class="pln">   open IN</span><span class="pun">,</span><span class="str">"$member"</span><span class="pun">;</span></code></li><li class="L3"><code class="language-perl"><span class="pln">   open OUT</span><span class="pun">,</span><span class="str">"&gt;NOG.member.fmt"</span><span class="pun">;</span></code></li><li class="L4"><code class="language-perl"><span class="pln">   </span><span class="kwd">while</span><span class="pun">(&lt;</span><span class="pln">IN</span><span class="pun">&gt;){</span></code></li><li class="L5"><code class="language-perl"><span class="pln">      chomp</span><span class="pun">;</span></code></li><li class="L6"><code class="language-perl"><span class="pln">      </span><span class="lit">@array</span><span class="pun">=</span><span class="pln">split</span><span class="pun">/</span><span class="pln">\t</span><span class="pun">/;</span></code></li><li class="L7"><code class="language-perl"><span class="pln">      </span><span class="lit">@mlist</span><span class="pun">=</span><span class="pln">split</span><span class="pun">(</span><span class="str">","</span><span class="pun">,</span><span class="pln">$array</span><span class="pun">[</span><span class="lit">5</span><span class="pun">]);</span></code></li><li class="L8"><code class="language-perl"><span class="pln">      </span><span class="kwd">foreach</span><span class="pln"> </span><span class="kwd">my</span><span class="pln"> $mlist </span><span class="pun">(</span><span class="lit">@mlist</span><span class="pun">){</span></code></li><li class="L9"><code class="language-perl"><span class="pln">         </span><span class="kwd">print</span><span class="pln"> OUT </span><span class="str">"$array[1]\t$mlist\n"</span><span class="pun">;</span></code></li><li class="L0"><code class="language-perl"><span class="pln">      </span><span class="pun">}</span></code></li><li class="L1"><code class="language-perl"><span class="pln">   </span><span class="pun">}</span></code></li><li class="L2"><code class="language-perl"><span class="pln">   close IN</span><span class="pun">;</span></code></li><li class="L3"><code class="language-perl"><span class="pln">   close OUT</span><span class="pun">;</span></code></li><li class="L4"><code class="language-perl"><span class="pun">}</span></code></li><li class="L5"><code class="language-perl"></code></li><li class="L6"><code class="language-perl"><span class="kwd">sub</span><span class="pln"> parsing_member</span><span class="pun">{</span></code></li><li class="L7"><code class="language-perl"><span class="pln">   </span><span class="kwd">my</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$cog</span><span class="pun">,</span><span class="pln">$prot_id</span><span class="pun">);</span></code></li><li class="L8"><code class="language-perl"><span class="pln">   open MEMBER</span><span class="pun">,</span><span class="str">"NOG.member.fmt"</span><span class="pun">;</span></code></li><li class="L9"><code class="language-perl"><span class="pln">   </span><span class="kwd">while</span><span class="pun">(&lt;</span><span class="pln">MEMBER</span><span class="pun">&gt;){</span></code></li><li class="L0"><code class="language-perl"><span class="pln">      chomp</span><span class="pun">;</span></code></li><li class="L1"><code class="language-perl"><span class="pln">      </span><span class="kwd">if</span><span class="pun">(</span><span class="str">/^#/</span><span class="pun">){</span><span class="kwd">next</span><span class="pun">;}</span></code></li><li class="L2"><code class="language-perl"><span class="pln">      </span><span class="pun">(</span><span class="pln">$cog</span><span class="pun">,</span><span class="pln">$prot_id</span><span class="pun">)=(</span><span class="pln">split</span><span class="pun">(</span><span class="str">/\t/</span><span class="pun">,</span><span class="pln">$_</span><span class="pun">))[</span><span class="lit">0</span><span class="pun">,</span><span class="lit">1</span><span class="pun">];</span></code></li><li class="L3"><code class="language-perl"><span class="pln">      $MEM</span><span class="pun">{</span><span class="pln">$prot_id</span><span class="pun">}=</span><span class="pln">$cog</span><span class="pun">;</span></code></li><li class="L4"><code class="language-perl"><span class="pln">   </span><span class="pun">}</span></code></li><li class="L5"><code class="language-perl"><span class="pln">   close MEMBER</span><span class="pun">;</span></code></li><li class="L6"><code class="language-perl"><span class="pun">}</span></code></li><li class="L7"><code class="language-perl"></code></li><li class="L8"><code class="language-perl"></code></li><li class="L9"><code class="language-perl"><span class="kwd">sub</span><span class="pln"> code</span><span class="pun">{</span></code></li><li class="L0"><code class="language-perl"><span class="pln">    </span><span class="pun">%</span><span class="pln">CODE</span><span class="pun">=(</span></code></li><li class="L1"><code class="language-perl"><span class="pln">    </span><span class="str">"J"</span><span class="pun">=&gt;</span><span class="str">"INFORMATION STORAGE AND PROCESSING\tTranslation, ribosomal structure and biogenesis"</span><span class="pun">,</span></code></li><li class="L2"><code class="language-perl"><span class="pln">    </span><span class="str">"A"</span><span class="pun">=&gt;</span><span class="str">"INFORMATION STORAGE AND PROCESSING\tRNA processing and modification"</span><span class="pun">,</span></code></li><li class="L3"><code class="language-perl"><span class="pln">    </span><span class="str">"K"</span><span class="pun">=&gt;</span><span class="str">"INFORMATION STORAGE AND PROCESSING\tTranscription"</span><span class="pun">,</span></code></li><li class="L4"><code class="language-perl"><span class="pln">    </span><span class="str">"L"</span><span class="pun">=&gt;</span><span class="str">"INFORMATION STORAGE AND PROCESSING\tReplication, recombination and repair"</span><span class="pun">,</span></code></li><li class="L5"><code class="language-perl"><span class="pln">    </span><span class="str">"B"</span><span class="pun">=&gt;</span><span class="str">"INFORMATION STORAGE AND PROCESSING\tChromatin structure and dynamics"</span><span class="pun">,</span></code></li><li class="L6"><code class="language-perl"></code></li><li class="L7"><code class="language-perl"><span class="pln">    </span><span class="str">"D"</span><span class="pun">=&gt;</span><span class="str">"CELLULAR PROCESSES AND SIGNALING\tCell cycle control, cell division, chromosome partitioning"</span><span class="pun">,</span></code></li><li class="L8"><code class="language-perl"><span class="pln">    </span><span class="str">"Y"</span><span class="pun">=&gt;</span><span class="str">"CELLULAR PROCESSES AND SIGNALING\tNuclear structure"</span><span class="pun">,</span></code></li><li class="L9"><code class="language-perl"><span class="pln">    </span><span class="str">"V"</span><span class="pun">=&gt;</span><span class="str">"CELLULAR PROCESSES AND SIGNALING\tDefense mechanisms"</span><span class="pun">,</span></code></li><li class="L0"><code class="language-perl"><span class="pln">    </span><span class="str">"T"</span><span class="pun">=&gt;</span><span class="str">"CELLULAR PROCESSES AND SIGNALING\tSignal transduction mechanisms"</span><span class="pun">,</span></code></li><li class="L1"><code class="language-perl"><span class="pln">    </span><span class="str">"M"</span><span class="pun">=&gt;</span><span class="str">"CELLULAR PROCESSES AND SIGNALING\tCell wall/membrane/envelope biogenesis"</span><span class="pun">,</span></code></li><li class="L2"><code class="language-perl"><span class="pln">    </span><span class="str">"N"</span><span class="pun">=&gt;</span><span class="str">"CELLULAR PROCESSES AND SIGNALING\tCell motility"</span><span class="pun">,</span></code></li><li class="L3"><code class="language-perl"><span class="pln">    </span><span class="str">"Z"</span><span class="pun">=&gt;</span><span class="str">"CELLULAR PROCESSES AND SIGNALING\tCytoskeleton"</span><span class="pun">,</span></code></li><li class="L4"><code class="language-perl"><span class="pln">    </span><span class="str">"W"</span><span class="pun">=&gt;</span><span class="str">"CELLULAR PROCESSES AND SIGNALING\tExtracellular structures"</span><span class="pun">,</span></code></li><li class="L5"><code class="language-perl"><span class="pln">    </span><span class="str">"U"</span><span class="pun">=&gt;</span><span class="str">"CELLULAR PROCESSES AND SIGNALING\tIntracellular trafficking, secretion, and vesicular transport"</span><span class="pun">,</span></code></li><li class="L6"><code class="language-perl"><span class="pln">    </span><span class="str">"O"</span><span class="pun">=&gt;</span><span class="str">"CELLULAR PROCESSES AND SIGNALING\tPosttranslational modification, protein turnover, chaperones"</span><span class="pun">,</span></code></li><li class="L7"><code class="language-perl"></code></li><li class="L8"><code class="language-perl"><span class="pln">    </span><span class="str">"C"</span><span class="pun">=&gt;</span><span class="str">"METABOLISM\tEnergy production and conversion"</span><span class="pun">,</span></code></li><li class="L9"><code class="language-perl"><span class="pln">    </span><span class="str">"G"</span><span class="pun">=&gt;</span><span class="str">"METABOLISM\tCarbohydrate transport and metabolism"</span><span class="pun">,</span></code></li><li class="L0"><code class="language-perl"><span class="pln">    </span><span class="str">"E"</span><span class="pun">=&gt;</span><span class="str">"METABOLISM\tAmino acid transport and metabolism"</span><span class="pun">,</span></code></li><li class="L1"><code class="language-perl"><span class="pln">    </span><span class="str">"F"</span><span class="pun">=&gt;</span><span class="str">"METABOLISM\tNucleotide transport and metabolism"</span><span class="pun">,</span></code></li><li class="L2"><code class="language-perl"><span class="pln">    </span><span class="str">"H"</span><span class="pun">=&gt;</span><span class="str">"METABOLISM\tCoenzyme transport and metabolism"</span><span class="pun">,</span></code></li><li class="L3"><code class="language-perl"><span class="pln">    </span><span class="str">"I"</span><span class="pun">=&gt;</span><span class="str">"METABOLISM\tLipid transport and metabolism"</span><span class="pun">,</span></code></li><li class="L4"><code class="language-perl"><span class="pln">    </span><span class="str">"P"</span><span class="pun">=&gt;</span><span class="str">"METABOLISM\tInorganic ion transport and metabolism"</span><span class="pun">,</span></code></li><li class="L5"><code class="language-perl"><span class="pln">    </span><span class="str">"Q"</span><span class="pun">=&gt;</span><span class="str">"METABOLISM\tSecondary metabolites biosynthesis, transport and catabolism"</span><span class="pun">,</span></code></li><li class="L6"><code class="language-perl"></code></li><li class="L7"><code class="language-perl"><span class="pln">    </span><span class="str">"R"</span><span class="pun">=&gt;</span><span class="str">"POORLY CHARACTERIZED\tGeneral function prediction only"</span><span class="pun">,</span></code></li><li class="L8"><code class="language-perl"><span class="pln">    </span><span class="str">"S"</span><span class="pun">=&gt;</span><span class="str">"POORLY CHARACTERIZED\tFunction unknown"</span><span class="pun">,</span></code></li><li class="L9"><code class="language-perl"></code></li><li class="L0"><code class="language-perl"><span class="pln">    </span><span class="pun">);</span></code></li><li class="L1"><code class="language-perl"><span class="pun">}</span></code></li><li class="L2"><code class="language-perl"></code></li><li class="L3"><code class="language-perl"><span class="kwd">sub</span><span class="pln"> plot</span><span class="pun">{</span></code></li><li class="L4"><code class="language-perl"><span class="pln">   </span><span class="kwd">my</span><span class="pln"> </span><span class="pun">(</span><span class="pln">$input</span><span class="pun">,</span><span class="pln">$png</span><span class="pun">)=</span><span class="lit">@_</span><span class="pun">;</span></code></li><li class="L5"><code class="language-perl"><span class="pln">   </span><span class="kwd">my</span><span class="pln"> $Rcmd</span><span class="pun">=&lt;&lt;</span><span class="pln">RCOMMAND</span><span class="pun">;</span></code></li><li class="L6"><code class="language-perl"><span class="pln">inputfile</span><span class="pun">&lt;-</span><span class="str">"$input"</span></code></li><li class="L7"><code class="language-perl"><span class="pln">outputfile</span><span class="pun">&lt;-</span><span class="str">"$png"</span></code></li><li class="L8"><code class="language-perl"><span class="pln">library</span><span class="pun">(</span><span class="pln">ggplot2</span><span class="pun">)</span></code></li><li class="L9"><code class="language-perl"><span class="pln">z</span><span class="pun">&lt;-</span><span class="pln">read</span><span class="pun">.</span><span class="pln">table</span><span class="pun">(</span><span class="pln">inputfile</span><span class="pun">,</span><span class="pln">sep</span><span class="pun">=</span><span class="str">"\\t"</span><span class="pun">,</span><span class="pln">header</span><span class="pun">=</span><span class="pln">F</span><span class="pun">)</span></code></li><li class="L0"><code class="language-perl"><span class="pln">names</span><span class="pun">(</span><span class="pln">z</span><span class="pun">)&lt;-</span><span class="pln">c</span><span class="pun">(</span><span class="str">"code"</span><span class="pun">,</span><span class="str">"classification"</span><span class="pun">,</span><span class="str">"code_name"</span><span class="pun">,</span><span class="str">"counts"</span><span class="pun">)</span></code></li><li class="L1"><code class="language-perl"><span class="pln">p</span><span class="pun">&lt;-</span><span class="pln">ggplot</span><span class="pun">(</span><span class="pln">z</span><span class="pun">,</span><span class="pln">aes</span><span class="pun">(</span><span class="pln">code_name</span><span class="pun">,</span><span class="pln">counts</span><span class="pun">))</span></code></li><li class="L2"><code class="language-perl"><span class="pln">png</span><span class="pun">(</span><span class="pln">file</span><span class="pun">=</span><span class="pln">outputfile</span><span class="pun">,</span><span class="pln">width</span><span class="pun">=(</span><span class="lit">1024</span><span class="pun">*</span><span class="lit">4</span><span class="pun">),</span><span class="pln">height</span><span class="pun">=(</span><span class="lit">800</span><span class="pun">*</span><span class="lit">4</span><span class="pun">),</span><span class="pln">res</span><span class="pun">=</span><span class="lit">300</span><span class="pun">)</span></code></li><li class="L3"><code class="language-perl"><span class="pln">p</span><span class="pun">+</span><span class="pln">facet_grid</span><span class="pun">(.~</span><span class="pln">classification</span><span class="pun">,</span><span class="pln">scales</span><span class="pun">=</span><span class="str">"free_x"</span><span class="pun">,</span><span class="pln">space</span><span class="pun">=</span><span class="str">"free"</span><span class="pun">)+</span><span class="pln">theme_bw</span><span class="pun">()+</span><span class="pln">geom_bar</span><span class="pun">(</span><span class="pln">aes</span><span class="pun">(</span><span class="pln">fill</span><span class="pun">=</span><span class="pln">classification</span><span class="pun">,</span><span class="pln">position</span><span class="pun">=</span><span class="str">"dodge"</span><span class="pun">),</span><span class="pln">stat</span><span class="pun">=</span><span class="str">"identity"</span><span class="pun">)+</span><span class="pln">theme</span><span class="pun">(</span><span class="pln">legend</span><span class="pun">.</span><span class="pln">position</span><span class="pun">=</span><span class="str">"none"</span><span class="pun">,</span><span class="pln">axis</span><span class="pun">.</span><span class="pln">text</span><span class="pun">.</span><span class="pln">x</span><span class="pun">=</span><span class="pln">element_text</span><span class="pun">(</span><span class="pln">angle</span><span class="pun">=</span><span class="lit">75</span><span class="pun">,</span><span class="pln">hjust</span><span class="pun">=</span><span class="lit">1.0</span><span class="pun">,</span><span class="pln">size</span><span class="pun">=</span><span class="lit">16</span><span class="pun">),</span><span class="pln">axis</span><span class="pun">.</span><span class="pln">text</span><span class="pun">.</span><span class="pln">y</span><span class="pun">=</span><span class="pln">element_text</span><span class="pun">(</span><span class="pln">size</span><span class="pun">=</span><span class="lit">16</span><span class="pun">),</span><span class="pln">axis</span><span class="pun">.</span><span class="pln">title</span><span class="pun">.</span><span class="pln">x</span><span class="pun">=</span><span class="pln">element_text</span><span class="pun">(</span><span class="pln">size</span><span class="pun">=</span><span class="lit">18</span><span class="pun">),</span><span class="pln">axis</span><span class="pun">.</span><span class="pln">title</span><span class="pun">.</span><span class="pln">y</span><span class="pun">=</span><span class="pln">element_text</span><span class="pun">(</span><span class="pln">size</span><span class="pun">=</span><span class="lit">18</span><span class="pun">))+</span><span class="pln">ylab</span><span class="pun">(</span><span class="str">"Numbers of classification"</span><span class="pun">)+</span><span class="pln">xlab</span><span class="pun">(</span><span class="str">"classification"</span><span class="pun">)</span></code></li><li class="L4"><code class="language-perl"><span class="pln">dev</span><span class="pun">.</span><span class="pln">off</span><span class="pun">()</span></code></li><li class="L5"><code class="language-perl"><span class="pln">q</span><span class="pun">()</span></code></li><li class="L6"><code class="language-perl"><span class="pln">RCOMMAND</span></code></li><li class="L7"><code class="language-perl"><span class="pln">   open R</span><span class="pun">,</span><span class="str">"&gt;level_plot.R"</span><span class="pln"> </span><span class="pun">||</span><span class="kwd">die</span><span class="pln"> $</span><span class="pun">!;</span></code></li><li class="L8"><code class="language-perl"><span class="pln">   </span><span class="kwd">print</span><span class="pln"> R $Rcmd</span><span class="pun">;</span></code></li><li class="L9"><code class="language-perl"><span class="pln">   system</span><span class="pun">(</span><span class="str">"Rscript level_plot.R"</span><span class="pun">);</span></code></li><li class="L0"><code class="language-perl"><span class="pun">}</span></code></li><li class="L1"><code class="language-perl"></code></li><li class="L2"><code class="language-perl"><span class="pln">__DATA__</span></code></li><li class="L3"><code class="language-perl"><span class="pln">usage</span><span class="pun">:</span></code></li><li class="L4"><code class="language-perl"><span class="pln">perl eggNOG45_result_process</span><span class="pun">.</span><span class="pln">pl </span><span class="pun">-</span><span class="pln">annin </span><span class="pun">&lt;</span><span class="pln">NOG</span><span class="pun">.</span><span class="pln">annotations</span><span class="pun">.</span><span class="pln">tsv</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">-</span><span class="pln">member </span><span class="pun">&lt;</span><span class="pln">NOG</span><span class="pun">.</span><span class="pln">members</span><span class="pun">.</span><span class="pln">tsv</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">-</span><span class="pln">in </span><span class="pun">&lt;</span><span class="pln">blast_result</span><span class="pun">.</span><span class="pln">tab</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">-</span><span class="pln">annout </span><span class="pun">&lt;</span><span class="pln">result_ann</span><span class="pun">.</span><span class="pln">tab</span><span class="pun">&gt;</span><span class="pln"> </span><span class="pun">-</span><span class="pln">stat </span><span class="pun">&lt;</span><span class="pln">result_egstat</span><span class="pun">&gt;</span></code></li></ol></pre></div>
</body>
</html>